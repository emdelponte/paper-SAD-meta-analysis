mutate(n_diagram2 = case_when(n_diagrams < 8 ~ "1-7D",
TRUE ~ "8-12D"))
sad_all %>%
group_by(study, n_diagram2) %>%
arrange(rater_id) %>%
slice(1) %>%
tabyl(n_diagram2)
nrow(sad_all)
sad_all2 <- sad_all %>%
filter(UN_r > 0.3) %>%
filter(SAD_r > 0.3) %>%
filter(UN_a < 30) %>%
filter(UN_a > -30) %>%
filter(SAD_a < 30) %>%
filter(SAD_a > -30) %>%
filter(UN_b < 5) %>%
filter(UN_b > -5) %>%
filter(SAD_b < 5) %>%
filter(SAD_b > -5) %>%
mutate(gain_r = SAD_r - UN_r) %>%
mutate(gain_a = SAD_a - UN_a) %>%
mutate(gain_b = SAD_b - UN_b)
# number of raters after outlier removal
nrow(sad_all2)
# Number of raters removed
nrow(sad_all)-nrow(sad_all2)
# Percentage of outliers
(nrow(sad_all)-nrow(sad_all2))/nrow(sad_all)*100
# Check now number of raters per study
sad_all2 %>%   group_by(study, pub_year) %>%
tabyl(study) %>%
arrange(n)
sad_all2 <- sad_all2 %>%
filter(study != 79,
study != 97
)
nrow(sad_all2)
sad_all2 %>% group_by(study, pub_year) %>%
tabyl(study) %>%
arrange(n)
sad_all2 %>%
tabyl(study) %>%
arrange(study) %>%
write_csv("selected_final.csv")
nrow(sad_all2)
sad <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1oBa_OIko04157D0-Z0tV7dN8BJxq9fAjEfbOkoSKy5s/edit?usp=sharing", sheetid = "all-data")
sad %>%
group_by(study) %>%
summarize(n()) %>%
nrow()
sad_all <- sad %>%
filter(validation == "Unaided_aided") %>%
filter(!is.na(coefs)) %>%
filter(coefs != "R2") %>%
filter(coefs != "R2_CCC") %>%
filter(coefs != "R2_b") %>%
filter(n_diagrams < 13) %>%
filter(study != 67) %>%
filter(study != 64)
sad_all %>%
group_by(study) %>%
summarize(n()) %>%
nrow()
sad_all <- sad_all %>%
separate(Kind_of_lesion, into=c("lesion_number", "lesion_pattern"),sep = "L_", remove = F)
sad_all$lesion_number = recode_factor(sad_all$lesion_number,`N` = "Numerous Lesions", `F` = "Few Lesions",`S` = "Single lesion")
# Rename
sad_all$lesion_pattern = recode_factor(sad_all$lesion_pattern,`ED` = "Edge",
`ED_SP` = "Edge Splashed",
`INT` = "Internal",
`HET_COAL` = "Heterometric coalescent",
`HET_NO_COAL` = "Heterometric no coalescent",
`IS_COAL` = "Isometric coalescent",
`IS_NO_COAL` = "Isometric no coalescent",
`INER` = "Iner borne",
`Edge_born` = "Edge born")
# Obtain the Pearson's r from r-squared
sad_all <- sad_all %>%
mutate(UN_r = sqrt(unaided_R2)) %>%
mutate(SAD_r = sqrt(aided_R2))
sad_all %>%
group_by(study, pub_year) %>%
tabyl(study) %>%
arrange(n)
sad_all %>%
group_by(study, organ) %>%
arrange(rater_id) %>%
slice(1) %>%
tabyl(organ)
sad_all <- sad_all %>%
mutate(organ2 = case_when(organ == "Leaf" ~ "Leaf",
TRUE ~ "Other"))
sad_all %>%
group_by(study, pathogen_group) %>%
arrange(rater_id) %>%
slice(1) %>%
tabyl(pathogen_group) %>%
arrange(-n)
sad_all %>%
group_by(study, diag_type) %>%
arrange(rater_id) %>%
slice(1) %>%
tabyl(diag_type) %>%
arrange(-n)
sad_all <- sad_all %>%
mutate(diag_type2 = case_when(diag_type == "Drawing" ~ "Drawing",
TRUE ~ "Photo"))
sad_all %>%
group_by(study, n_diagrams) %>%
arrange(rater_id) %>%
slice(1) %>%
tabyl(n_diagrams) %>%
arrange(n_diagrams)
sad_all <- sad_all %>%
mutate(n_diagram2 = case_when(n_diagrams < 8 ~ "1-7D",
TRUE ~ "8-12D"))
sad_all %>%
group_by(study, n_diagram2) %>%
arrange(rater_id) %>%
slice(1) %>%
tabyl(n_diagram2)
nrow(sad_all)
sad_all2 <- sad_all %>%
filter(UN_r > 0.3) %>%
filter(SAD_r > 0.3) %>%
filter(UN_a < 30) %>%
filter(UN_a > -30) %>%
filter(SAD_a < 30) %>%
filter(SAD_a > -30) %>%
filter(UN_b < 5) %>%
filter(UN_b > -5) %>%
filter(SAD_b < 5) %>%
filter(SAD_b > -5) %>%
mutate(gain_r = SAD_r - UN_r) %>%
mutate(gain_a = SAD_a - UN_a) %>%
mutate(gain_b = SAD_b - UN_b)
# number of raters after outlier removal
nrow(sad_all2)
# Number of raters removed
nrow(sad_all)-nrow(sad_all2)
# Percentage of outliers
(nrow(sad_all)-nrow(sad_all2))/nrow(sad_all)*100
# Check now number of raters per study
sad_all2 %>%   group_by(study, pub_year) %>%
tabyl(study) %>%
arrange(n)
# number of raters after outlier removal
nrow(sad_all2)
# Number of raters removed
nrow(sad_all)-nrow(sad_all2)
# Percentage of outliers
(nrow(sad_all)-nrow(sad_all2))/nrow(sad_all)*100
sad_all2 %>%   group_by(study, pub_year) %>%
tabyl(study) %>%
arrange(n)
sad_all2 <- sad_all2 %>%
filter(study != 79,
study != 97,
study != 33,
study != 43,
study != 49
)
nrow(sad_all2)
sad_all2 %>% group_by(study, pub_year) %>%
tabyl(study) %>%
arrange(n)
sad_all2 %>%
tabyl(study) %>%
arrange(study) %>%
write_csv("selected_final.csv")
nrow(sad_all2)
sad_all2 %>% group_by(study, pub_year) %>%
tabyl(study) %>%
arrange(n)
sad_all2 <- sad_all2 %>%
filter(study != 79,
study != 97,
study != 33,
study != 43,
study != 49 ,
study != 46,
)
nrow(sad_all2)
sad_all2 %>% group_by(study, pub_year) %>%
tabyl(study) %>%
arrange(n)
sad_all2 %>%
tabyl(study) %>%
arrange(study) %>%
write_csv("selected_final.csv")
nrow(sad_all2)
sad_all2 %>% group_by(study, pub_year) %>%
tabyl(study) %>%
arrange(n)
# whrite selected
sad_all2 %>%
tabyl(study) %>%
arrange(study) %>%
write_csv("selected_final.csv")
p1_precision <- sad_all2 %>%
select(study, rater_id, SAD_r, UN_r) %>%
gather(stats, value, 3:4) %>%
ggplot(aes(value, stats, fill = stats))+
geom_density_ridges(scale = 3, alpha = 0.8)+
geom_vline(xintercept = mean(sad_all2$UN_r), linetype =2, size=1, color = "darkorange")+
theme(legend.position = "none")+
theme_minimal()+
geom_vline(xintercept = mean(sad_all2$SAD_r), linetype =2, size=1, color = "black")+ theme(legend.position = "none")+
scale_fill_colorblind()+
labs(y = "", x ="Precision (r)")
p2_precision <- sad_all2 %>%
select(study, rater_id, gain_r) %>%
ggplot(aes(gain_r, fill = "gain_r"))+
geom_density(alpha = 0.7)+
geom_vline(xintercept = mean(sad_all2$gain_r), linetype =2, size=1, color = "darkorange")+ theme(legend.position = "none")+
labs(x = "Gain in precision (r)")+
scale_fill_colorblind()
p3_precision <- sad_all2%>%
ggplot()+
theme_few()+
#geom_jitter(width =0.1, color = "gray90")+
coord_flip()+
stat_summary(aes(factor(study), UN_r), fun.data = "mean_cl_boot", colour = "darkorange", size = 0.2)+
stat_summary(aes(factor(study), SAD_r), fun.data = "mean_cl_boot", colour = "grey30", size = 0.2)+
geom_hline(yintercept = median(sad_all2$UN_r), linetype =1, size=0.5, color = "darkorange")+
geom_hline(yintercept = median(sad_all2$SAD_r), linetype =1, size=0.5, color = "grey30")+
theme(axis.text.y=element_blank())+
labs(x = "Study", y = "Precision (r)")
p4_precision <- sad_all2 %>%
ggplot()+
theme_few()+
#geom_jitter(width =0.1, color = "gray90")+
coord_flip()+
stat_summary(aes(reorder(factor(study), gain_r), gain_r), fun.data = "mean_cl_boot", colour = "grey50", size = 0.2)+
geom_hline(yintercept = mean(sad_all2$gain_r), linetype =2, size=0.5)+
geom_hline(yintercept = 0, linetype =1, size=0.5)+
labs(x = "", y = "Gain in Precision")+
theme(axis.text.y=element_blank())
plot_grid(p1_precision, p3_precision, p4_precision,
ncol =3, align = "vh")
ggsave("figs/P1_precision.png", width =8, height =3)
p2_accuracy1 <- sad_all2 %>%
select(study, rater_id, SAD_a, UN_a) %>%
gather(stats, value, 3:4) %>%
ggplot(aes(value, stats, fill = stats))+
geom_density_ridges(scale = 6, alpha = 0.8)+
scale_fill_colorblind()+
labs(y = "", x = "Intercept (a)")+
geom_vline(xintercept = 0, color = "gray50", linetype =2, size=1)+
theme(legend.position = "none")+
geom_vline(xintercept = mean(sad_all2$SAD_a), linetype =2, size=1, color = "black")+
geom_vline(xintercept = mean(sad_all2$UN_a), linetype =2, size=1, color = "darkorange")
p2_accuracy2 <- sad_all2 %>%
ggplot()+
theme_few()+
coord_flip()+
stat_summary(aes(factor(study), UN_a), fun.data = "mean_cl_boot", colour = "grey30", size = 0.2)+
stat_summary(aes(factor(study), SAD_a), fun.data = "mean_cl_boot", colour = "darkorange", size = 0.2)+
geom_hline(yintercept = median(sad_all2$SAD_a, na.rm = TRUE), linetype =1, size=0.5, color = "darkorange")+
geom_hline(yintercept = median(sad_all2$UN_a, na.rm = TRUE), linetype =1, size=0.5, color = "grey30")+
labs(y = "Intercept", x = "")+
theme(axis.text.y=element_blank())
p2_accuracy3 <- sad_all2 %>%
ggplot()+
theme_few()+
#geom_jitter(width =0.1, color = "gray90")+
coord_flip()+
stat_summary(aes(reorder(factor(study), gain_a), gain_a), fun.data = "mean_cl_boot", colour = "grey50", size = 0.2)+
geom_hline(yintercept = mean(sad_all2$gain_a, na.rm = TRUE), linetype =2, size=0.5)+
geom_hline(yintercept = 0, linetype =1, size=0.5)+
labs(x = "", y = "Constant bias (a) reduction ")+
theme(axis.text.y=element_blank())
plot_grid(p2_accuracy1,
p2_accuracy2,
p2_accuracy3,
ncol =3, align = "vh")
ggsave("figs/P1_accuracy_a.png", width =8, height =3)
p3_accuracy1 <- sad_all2 %>%
select(study, rater_id, SAD_b, UN_b) %>%
gather(stats, value, 3:4) %>%
ggplot(aes(value, stats, fill = stats))+
geom_density_ridges(scale = 6, alpha = 0.8)+
scale_fill_colorblind()+
labs(y = "", x = "Slope (b)")+
theme(legend.position = "none")+
geom_vline(xintercept = mean(sad_all2$SAD_b), linetype =1, size=1, color = "black")+
geom_vline(xintercept = 1, color = "gray50", linetype =2, size=1)+
geom_vline(xintercept = mean(sad_all2$UN_b), linetype =1, size=1, color = "darkorange")
p3_accuracy2 <- sad_all2 %>%
ggplot()+
theme_few()+
coord_flip()+
stat_summary(aes(factor(study), UN_b), fun.data = "mean_cl_boot", colour = "grey30", size = 0.2)+
stat_summary(aes(factor(study), SAD_b), fun.data = "mean_cl_boot", colour = "darkorange", size = 0.2)+
geom_hline(yintercept = median(sad_all2$SAD_b, na.rm = TRUE), linetype =1, size=0.5, color = "darkorange")+
geom_hline(yintercept = median(sad_all2$UN_b, na.rm = TRUE), linetype =1, size=0.5, color = "grey30")+
labs(y = "Slope", x = "")+
theme(axis.text.y=element_blank())
p3_accuracy3 <- sad_all2 %>%
ggplot()+
theme_few()+
#geom_jitter(width =0.1, color = "gray90")+
coord_flip()+
stat_summary(aes(reorder(factor(study), gain_b), gain_b), fun.data = "mean_cl_boot", colour = "grey50", size = 0.2)+
geom_hline(yintercept = mean(sad_all2$gain_b, na.rm = TRUE), linetype =2, size=0.5)+
geom_hline(yintercept = 0, linetype =1, size=0.5)+
labs(x = "", y = "Systematic bias (b) reduction ")+
theme(axis.text.y=element_blank())
plot_grid(p3_accuracy1,
p3_accuracy2,
p3_accuracy3,
ncol =3, align = "vh")
ggsave("figs/P3_accuracy_b.png", width =8, height =3)
sad_mv <- sad_all2 %>%
group_by(study, pathogen_group, organ2, diag_type2, n_diagram2,
Kind_of_lesion, min_sev, lesion_number, lesion_pattern, lesion_shape, coalesc, Kind_of_organ, max_sev) %>%
summarize(mean_Ur = mean(UN_r),
var_Ur = sd(UN_r)^2,
mean_Ar = mean(SAD_r),
var_Ar = sd(SAD_r)^2,
mean_Ua = mean(UN_a),
var_Ua = sd(UN_a)^2,
mean_Aa = mean(SAD_a),
var_Aa = sd(SAD_a)^2,
mean_Ub = mean(UN_b),
var_Ub = sd(UN_b)^2,
mean_Ab = mean(SAD_b),
var_Ab = sd(SAD_b)^2
) %>%
mutate(min_sev_class = case_when(
min_sev > 1 ~ "min_sev > 1",
TRUE ~ "min_sev <= 1")) %>%
mutate(max_sev_class = case_when(
max_sev > 50 ~ "maxsev > 50%",
TRUE ~ "max_sev < 50%"
))
sad_mv <- sad_mv %>%
#select(organ2, diag_type2, n_diagram2, Kind_of_lesion, lesion_number, lesion_pattern, lesion_shape, coalesc, Kind_of_organ, max_sev_class) %>%
mutate(SAD_r = case_when(
mean_Ar > 0.92 ~"r > 0.92",
mean_Ar < 0.78 ~ "r < 0.78",
TRUE  ~ "r 0.78 to 0.92"
) ) %>%
mutate(UN_r = case_when(
mean_Ur > 0.92 ~"r > 0.92",
mean_Ur < 0.78 ~ "r < 0.78",
TRUE  ~ "r 0.78 to 0.92"
) ) %>%
mutate(SAD_a = case_when(
mean_Aa > 4  ~"a > 4",
TRUE < -4 ~"a < -4"
) ) %>%
mutate(UN_a = case_when(
mean_Ua > 4  ~"a > 4",
TRUE  ~ " a < 4"
) ) %>%
mutate(SAD_b = case_when(
mean_Ab > 1.1 ~  "b > 1.1",
TRUE ~ "b < 1.1")) %>%
mutate(UN_b = case_when(
mean_Ub > 1.1 ~  "b > 1.1",
TRUE ~ "b < 1.1"))
library(FactoMineR)
sad_mv <- sad_mv  %>%
filter(!is.na(coalesc))
attach(sad_mv)
dat_mca <- data.frame(coalesc,
lesion_number, lesion_shape, max_sev_class, UN_r,  UN_a, UN_b)
cats <- apply(dat_mca, 2, function(x) nlevels(as.factor(x))) # enumera as categorias
mca1 <- MCA(dat_mca, graph = TRUE)
res.mca <- MCA(dat_mca, graph = FALSE)
library("factoextra")
eig.val <- get_eigenvalue(res.mca)
head(eig.val)
fviz_screeplot(res.mca, addlabels = TRUE, ylim = c(0, 45))
fviz_cos2(res.mca, choice = "var", axes = 1:2)
cont_dim1 <- fviz_contrib(res.mca, choice = "var", axes = 1, top = 15)
cont_dim2 <- fviz_contrib(res.mca, choice = "var", axes = 2, top = 15)
cont_dim12 <- fviz_contrib(res.mca, choice = "var", axes = 1:2, top = 15)
p <- fviz_mca_var(res.mca,
label = "var", repel = T,
col.var = "cos2",
ggtheme = theme_light())+
scale_color_continuous(low = "black", high = "#E69F00") +
theme(legend.position = "right")+
labs(color = expression(cos^{2}, title = ""))
p1 <- plot_grid(cont_dim1, cont_dim2, ncol = 1, align = "vh")
plot_grid(p, labels = LETTERS, ncol =1, align = "vh", rel_widths  = c(1.1, 0.8))
ggsave("figs/MCA_plot_Unaided.png", width =7, height =7)
sad_mv2 <- sad_all2 %>%
group_by(study, img_dev, col_type, HB, rater_exp, pathogen_group, organ2, diag_type2, n_diagram2,
Kind_of_lesion, min_sev, lesion_number, lesion_pattern, lesion_shape, coalesc, Kind_of_organ, max_sev) %>%
summarize(mean_Ur = mean(UN_r),
var_Ur = sd(UN_r)^2,
mean_Ar = mean(SAD_r),
var_Ar = sd(SAD_r)^2,
mean_gainr = mean(gain_r),
var_gainr = sd(gain_r)^2,
mean_Ua = mean(UN_a),
var_Ua = sd(UN_a)^2,
mean_Aa = mean(SAD_a),
var_Aa = sd(SAD_a)^2,
mean_Ub = mean(UN_b),
var_Ub = sd(UN_b)^2,
mean_Ab = mean(SAD_b),
var_Ab = sd(SAD_b)^2 ) %>%
mutate(min_sev_class = case_when(
min_sev > 1 ~ "min_sev > 1",
TRUE ~ "min_sev <= 1")) %>%
mutate(max_sev_class = case_when(
max_sev > 50 ~ "maxsev > 50%",
TRUE ~ "max_sev < 50%"
))
sad_mv2 <- sad_mv2 %>%
mutate(SAD_r = case_when(
mean_Ar > 0.9 ~"r >0.9",
TRUE  ~ "r <0.9"
) ) %>%
mutate(SAD_a = case_when(
mean_Aa > 1.5  ~"a > 1.5",
TRUE   ~ "a < 1.5"
) ) %>%
mutate(SAD_b = case_when(
mean_Ab > 1 ~  "b >1",
TRUE ~ "b <1")) %>%
mutate(gain_r = case_when(
mean_gainr > 0.05 ~ "gain r > 0.05",
TRUE ~ "gain r < 0.05"
))  %>%
mutate(rater_Ur = case_when(
mean_Ur > 0.85 ~ "Rater Ur > 0.85",
TRUE ~ "Rater Ur <= 0.85"
))
sad_mv2 <- sad_mv2  %>%
filter(!is.na(coalesc))
attach(sad_mv2)
dat_mca2 <- data.frame(coalesc,  rater_Ur,    lesion_number, lesion_shape, max_sev_class,SAD_r, SAD_a, SAD_b, gain_r)
detach(sad_mv2)
cats <- apply(dat_mca2, 2, function(x) nlevels(as.factor(x))) # enumera as categorias
mca1 <- MCA(dat_mca2, graph = TRUE)
res.mca <- MCA(dat_mca2, graph = FALSE)
library("factoextra")
eig.val <- get_eigenvalue(res.mca)
head(eig.val)
fviz_screeplot(res.mca, addlabels = TRUE, ylim = c(0, 45))
fviz_cos2(res.mca, choice = "var", axes = 1:2)
cont_dim1 <- fviz_contrib(res.mca, choice = "var", axes = 1, top = 15)
cont_dim2 <- fviz_contrib(res.mca, choice = "var", axes = 2, top = 15)
cont_dim12 <- fviz_contrib(res.mca, choice = "var", axes = 1:2, top = 15)
p <- fviz_mca_var(res.mca,
label = "var", repel = T,
col.var =  "contrib",
ggtheme = theme_light()
)+  scale_color_continuous(low = "black", high = "#E69F00") +
theme(legend.position = "right")+
labs(color = expression(cos^{2}, title = ""))
p1 <- plot_grid(cont_dim1, cont_dim2, ncol = 1, align = "vh")
plot_grid(p, labels = LETTERS, ncol =1, align = "vh", rel_widths  = c(1.1, 0.8))
ggsave("figs/MCA_plot_aided.png", width =7, height =7)
sad_all2 %>%
tabyl(Kind_of_organ)
sad_all3 <- sad_all2 %>%
filter(Kind_of_organ != "Composite fruit") %>%
filter(Kind_of_organ != "Stalk") %>%
filter(Kind_of_organ != "Composite leaf")
sad_all2 %>%
tabyl(Kind_of_organ)
sad_all2 %>%
tabyl(Kind_of_organ, lesion_number)
sad_all2 %>%
tabyl(Kind_of_organ, lesion_shape)
sad_all2 %>%
tabyl(lesion_number, lesion_shape)
sad_all2 %>%
tabyl(Kind_of_organ, coalesc)
sad_all2 %>%
tabyl(lesion_number, coalesc)
sad_mv %>%
ggplot(aes(Kind_of_organ, mean_Ur))+
geom_jitter(width =0.1, size = 2, color = "gray80")+
stat_summary(fun.data = "mean_cl_boot", colour = "red", size = 0.5)+
scale_color_colorblind()
dat_ma <- sad_all3 %>%
select(study, rater_id, organ2, n_diagram2, HB, pathogen_group, diag_type,
col_type, lesion_shape, coalesc, lesion_number, min_sev, max_sev, n_diagrams, UN_r, SAD_r, UN_a, SAD_a, UN_b, SAD_b) %>%
mutate(rater_class = case_when(UN_r > 0.92 ~ "Good",
UN_r < 0.78 ~ "Poor",
TRUE ~ "Fair")) %>%
gather(stats, value, 15:20)
View(dat_ma)
full_rA <- rma(mean_Ar, var_Ar, mods = ~ coalesc + n_diagram, lesion_number + lesion_shape + min_sev_class + max_sev_class, data = sad_mv, method = "ML")
full_rA <- rma(mean_Ar, var_Ar, mods = ~ coalesc + n_diagram2, lesion_number + lesion_shape + min_sev_class + max_sev_class, data = sad_mv, method = "ML")
library(MuMIn)
eval(metafor:::.MuMIn)
library(metafor)
full_r <- rma(mean_Ur, var_Ur, mods = ~ coalesc + lesion_number + lesion_shape + min_sev_class + max_sev_class, data = sad_mv, method = "ML")
res_r <- dredge(full_r, trace=2)
subset(res_r, delta <= 2, recalc.weights=FALSE)
summary(model.avg(res_r, revised.var=FALSE))
print(res_r)
plot(res_r)
importance(res_r)
full_rA <- rma(mean_Ar, var_Ar, mods = ~ coalesc + n_diagram2, lesion_number + lesion_shape + min_sev_class + max_sev_class, data = sad_mv, method = "ML")
full_rA <- rma(mean_Ar, var_Ar, mods = ~ coalesc +  lesion_number + lesion_shape + min_sev_class + max_sev_class, data = sad_mv, method = "ML")
res_rA <- dredge(full_rA, trace=2)
par(mar = c(3,5,6,4))
plot(res_rA, labAsExpr = TRUE)
subset(res_rA, delta <= 2, recalc.weights=FALSE)
summary(model.avg(res_rA, revised.var=FALSE))
print(res_rA)
plot(res_rA)
importance(res_rA)
